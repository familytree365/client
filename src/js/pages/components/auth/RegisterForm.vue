<template>
    <!-- <AuthIndex> -->
        <!-- <template>         -->
            <div class="auth-form is-gapless">
                <div class="mb-5">
                    <NuxtLink to="/" class=" is-size-6 is-flex has-text-link has-text-weight-medium mb-2 ">
                        <!-- <fa icon="angle-left" class="mt-1 mr-2" /> -->
                        Back to Home
                    </NuxtLink>
                    <h1 class="is-size-4 has-text-black has-text-weight-bold">
                        Create your account
                    </h1>
                </div>
                <div v-if="message" class="notification is-danger">
                    {{ message }}
                </div>
                <div v-for="(error, index) in errorInput" :key="index" class="notification is-danger">
                    {{ error[0] }}
                </div>
                <div class="mb-5">
                    <div class="columns">
                        <div class="column">
                            <div class="field">
                                <!-- <ValidationProvider name="First Name" rules="required|min:3"> -->
                                    <p class="control has-icon-left has-icon-right">
                                        <input class="input is-large" type="text" placeholder="First name" v-model="first_name" />
                                    </p>
                                    <p class="has-text-danger p-2 is-size-7"></p>
                                <!-- </ValidationProvider> -->
                            </div>
                        </div>
                        <div class="column">
                            <div class="field">
                                <!-- <ValidationProvider name="Last Name" rules="required|min:3"> -->
                                    <p class="control has-icons-left has-icons-right">
                                        <input class="input is-large" type="text" placeholder="Last name" v-model="last_name" />
                                        <span class="icon is-small is-left">
                                            <!-- <fa icon="user" /> -->
                                        </span> 
                                    </p>
                                    <p class="has-text-danger p-2 is-size-7"></p>
                                <!-- </ValidationProvider> -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-5">
                    <div class="field">
                        <!-- <ValidationProvider name="Email" rules="required|email"> -->
                            <p class="control has-icons-left has-icons-right">
                                <input class="input is-large" type="text" placeholder="Email adddress" v-model="email" />
                                <span class="icon is-small is-left">
                                    <!-- <fa icon="envelope" /> -->
                                </span>
                            </p>
                        <!-- </ValidationProvider> -->
                    </div>
                </div>
                <div class="mb-5">
                    <div class="field">
                        <!-- <ValidationProvider name="Password" vid="password" rules="required|min:8"> -->
                            <p class="control has-icons-left has-icons-right">
                                <input class="input is-large" type="password" placeholder="Password" v-model="password" />
                                <span class="icon is-small is-left">
                                    <!-- <fa icon="lock" /> -->
                                </span>
                            </p>
                        <!-- </ValidationProvider> -->
                    </div>
                </div>
                <div class="mb-5">
                    <div class="field">
                        <!-- <ValidationProvider name="Paaword Confirm" rules="required|confirmed:password"> -->
                            <p class="control has-icons-left has-icons-right">
                                <input class="input is-large" placeholder="Confirm Password" v-model="password_confirmation" />
                                <span class="icon is-small is-left">
                                    <!-- <fa icon="lock" /> -->
                                </span>
                            </p>
                            <p class="has-text-danger p-2 is-size-7" ></p>
                        <!-- </ValidationProvider> -->
                    </div>
                </div>
                <div class="mb-5 px-1">
                    <div class="columns is-mobile is-gapless">
                        <div class="column">
                            <!-- <ValidationProvider name="Terms And Conditions" :rules="{ required: { allowFalse: false } }" > -->
                                <label class="checkbox">
                                    <input type="checkbox" v-model="terms" />
                                    Agree to
                                    <NuxtLink to="/termsandconditions" class="has-text-link has-text-weight-medium" >
                                        terms and conditions
                                    </NuxtLink>
                                    <div>
                                        <p class="help has-text-danger"></p>
                                    </div>
                                </label>
                            <!-- </ValidationProvider> -->
                        </div>
                    </div>
                </div>
                <div class="mb-6">
                    <button class=" button theme-button theme-button-xl has-background-primary is-uppercase has-text-weight-medium has-text-white ">
                        register
                    </button>
                </div>
                <div>
                    <p class=" is-size-6 has-text-dark has-text-centered has-text-weight-regular " >
                        Already have an account?
                        <NuxtLink to="/login" class="has-text-link has-text-weight-medium">
                            Sign in
                        </NuxtLink>
                    </p>
                </div>
                <div class="divider">or</div>
                <a @click="loginSocial('google')" href="javascript:;" class="btn cnt-g">
                    <img src="~assets/images/google.jpg" />
                    Continue with google
                </a>
                <a @click="loginSocial('facebook')" href="javascript:;" class="btn cnt-g">
                    <img src="~assets/images/facebook.png" />
                    Continue with Facebook
                </a>
                <a @click="loginSocial('github')" href="javascript:;" class="btn cnt-g mb-5">
                    <img src="~assets/images/github.png" />
                    Continue with Github
                </a>
            </div>
</template>

<script>
  import AuthIndex from "~/components/auth/Index.vue";
  import { mapState } from "vuex";
  import { library } from "@fortawesome/fontawesome-svg-core";
  import { faEnvelope, faCheck, faExclamationTriangle, faLock, faUser, } from "@fortawesome/free-solid-svg-icons";
  import { focus } from "@enso-ui/directives";
  import Errors from "@enso-ui/laravel-validation";
//   import RevealPassword from "@enso-ui/forms/src/bulma/parts/RevealPassword.vue";
  import { ref, computed, useStore, watch } from 'vue';

  library.add([faEnvelope, faCheck, faExclamationTriangle, faLock, faUser]);

  export default {
    name: "RegisterForm",
    components: { AuthIndex },
    directives: { focus },
    props: {
      action: {
        required: true,
        type: String,
      },
      route: {
        required: true,
        type: String,
      },
    },
    setup() {
        const first_name = ref('')
        const last_name = ref('')
        const email = ref('')
        const errorInput = ref('')
        const message = ref('')
        const isSuccessful = ref(false)
        const loading = ref(false)
        const passwordMeta = ref({
            content: 'password'
        })
        const password_confirmation = ref(null)
        const confirmationMeta = ref({
            content: 'password'
        })
        const terms = ref('')
        const device_name = ref('mac')
        // const store = useStore()
        return {
            one: computed(() => store.state[meta])
        }
        const hasPassword = computed(() => {
            return this.password !== null && this.password.length;
        })
        const match = computed(() => {
            return this.hasPassword && this.password === this.password_confirmation;
        })
        const postParams = computed(() => {
            return this.registerParams;
        })
        const registerParams = computed(() => {
            const {
            email,
            password,
            first_name,
            last_name,
            password_confirmation,
            } = this;

            return {
            email,
            password,
            first_name,
            last_name,
            password_confirmation,
            };
        })
        const registerLink = computed(() => {
            return "api/register";
        })
        function loginSocial(provider) {
            this.provider = provider;        
            window.location.href = `${process.env.baseUrl}/api/login/${provider}`;
        }
        function submit() {
            this.loading = true;
            this.isSuccessful = false;
            let user = this.postParams;
            this.$axios
            .get('/sanctum/csrf-cookie').then(response =>{
            this.$axios
                .post(this.registerLink, user)
                .then(({ data }) => {
                this.loading = false;
                this.isSuccessful = true;
                this.$emit("success", data);
                })
                .catch((error) => {
                console.log(error);
                this.loading = false;
                const { status, data } = error.response;
                switch (status) {
                    case 422:
                    this.errorInput = data.errors;
                    break;
                    case 429:
                    // this.$toastr.error(data.message); // error Toastr can't displayed
                    this.message = data.message;
                    break;
                    case 500:
                    this.message = data.message;
                    this.$forceUpdate();
                    break;
                    default:
                    throw error;
                }
                });
            })
        }
        function openWindow(url, title, options = {}) {
            if (typeof url === 'object') {
                options = url
                url = ''
            }
            options = {
                url,
                title,
                width: 600,
                height: 720,
                ...options
            }
            const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screen.left
            const dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screen.top
            const width = window.innerWidth || document.documentElement.clientWidth || window.screen.width
            const height = window.innerHeight || document.documentElement.clientHeight || window.screen.height
            options.left = ((width / 2) - (options.width / 2)) + dualScreenLeft
            options.top = ((height / 2) - (options.height / 2)) + dualScreenTop
            const optionsStr = Object.keys(options).reduce((acc, key) => {
                acc.push(`${key}=${options[key]}`)
                return acc
            }, []).join(',')
            const newWindow = window.open(url, title, optionsStr)
            if (window.focus) {
                newWindow.focus()
            }
            // console.log(newWindow);
            return newWindow
        }
    }
}

  
</script>

<style scoped>
@import '~/assets/css/base.css';
</style>
